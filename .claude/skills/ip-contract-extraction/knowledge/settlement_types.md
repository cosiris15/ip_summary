# 结算类型判断规则

## 概述

根据Excel样例的第60列"结算类型"字段，需要判断合同的结算模式。结算类型共有6种：

| 编号 | 类型名称 | 描述 |
|------|---------|------|
| 1 | 买断 | 一次性支付固定金额，无分成 |
| 2 | 买断+奖励分成 | 支付买断金额+超出部分分成 |
| 3 | 保底分成 | 保底金额+超出部分分成 |
| 4 | 分成 | 纯分成，无买断 |
| 5 | 买断阶梯分成/阶梯分成 | 根据收益阶梯不同分成比例 |
| 6 | 其他 | 无法归类的结算方式 |

## 判断流程

```
开始
  ↓
是否包含"买断"？
  ├─ 是 → 是否包含"阶梯"？
  │       ├─ 是 → 结算类型 = 5（买断阶梯分成）
  │       └─ 否 → 是否包含"分成"？
  │               ├─ 是 → 结算类型 = 2（买断+奖励分成）
  │               └─ 否 → 结算类型 = 1（买断）
  └─ 否 → 是否包含"保底"？
          ├─ 是 → 结算类型 = 3（保底分成）
          └─ 否 → 是否包含"分成"？
                  ├─ 是 → 是否包含"阶梯"？
                  │       ├─ 是 → 结算类型 = 5（阶梯分成）
                  │       └─ 否 → 结算类型 = 4（纯分成）
                  └─ 否 → 结算类型 = 6（其他）
```

## 详细判断规则

### 类型1：买断

**识别特征**：
- ✅ 包含关键词："买断"、"元/幅"、"元/页"、"元/张"、"一次性支付"
- ✅ 明确固定金额
- ❌ 不包含"分成"、"保底"、"阶梯"

**合同原文示例**：
> 甲方按幅支付给乙方费用的基准为人民币【250】元/幅（¥【250】元/幅）。

**判断逻辑**：
```python
if ("买断" in text or "元/幅" in text or "元/页" in text) and \
   ("分成" not in text) and \
   ("阶梯" not in text) and \
   ("保底" not in text):
    return 1  # 买断
```

**提取字段**：
- 结算类型：1
- 买断金额：250（从"250元/幅"提取）
- 币种：12（人民币）

---

### 类型2：买断+奖励分成

**识别特征**：
- ✅ 同时包含"买断"和"分成"
- ✅ 有固定稿费+收益分成
- ❌ 不包含"阶梯"、"保底"

**合同原文示例**：
> （1）稿费：甲方按幅支付给乙方费用的基准为人民币【250】元/幅（¥【250】元/幅）。
> （2）连载收入分成：甲方基于漫画作品的付费阅读所取得的总收入扣除25%渠道成本后（以下简称"实际收入"），分配其中的【10】%给乙方。

**判断逻辑**：
```python
if ("买断" in text or "稿费" in text or "元/幅" in text) and \
   ("分成" in text) and \
   ("阶梯" not in text) and \
   ("保底" not in text):
    return 2  # 买断+奖励分成
```

**提取字段**：
- 结算类型：2
- 买断金额：250
- 我方自用分成比例：10%
- 币种：12

---

### 类型3：保底分成

**识别特征**：
- ✅ 包含关键词："保底"
- ✅ 保底金额+超出部分分成
- ✅ 可能包含累计保底金额

**合同原文示例**：
> 甲方向乙方支付保底金额人民币【50000】元，当实际收益超过保底金额时，超出部分按【30】%的比例分成给乙方。

**判断逻辑**：
```python
if "保底" in text:
    return 3  # 保底分成
```

**提取字段**：
- 结算类型：3
- 保底金额：50000
- 保底分成比例：30%
- 是否预付：1（如明确"预付"）
- 币种：12

---

### 类型4：分成（纯分成）

**识别特征**：
- ✅ 只包含"分成"
- ❌ 不包含"买断"、"稿费"、"保底"、"阶梯"
- ✅ 通常是收益比例分成

**合同原文示例**：
> 双方同意，当漫画作品单月实际收入的50%高于当月稿费，则连载费用的支付方式由"稿费+分成"模式转为纯分成模式，即甲方不再向乙方支付漫画作品连载的稿费，仅分配实际收入的【60】%给乙方。

**判断逻辑**：
```python
if ("分成" in text) and \
   ("买断" not in text) and \
   ("稿费" not in text) and \
   ("保底" not in text) and \
   ("阶梯" not in text):
    return 4  # 纯分成
```

**提取字段**：
- 结算类型：4
- 我方自用分成比例：60%
- 币种：12

---

### 类型5：买断阶梯分成/阶梯分成

**识别特征**：
- ✅ 包含关键词："阶梯"
- ✅ 不同收益阶梯对应不同分成比例
- ✅ 可能同时包含"买断"

**合同原文示例（静态漫画）**：
> 阶梯分成线：
> - 0-10万：分成比例30%
> - 10万-50万：分成比例40%
> - 50万以上：分成比例50%

**合同原文示例（动态漫画）**：
> 流水收入累计达到：
> - 0-100万：分成比例20%
> - 100万-500万：分成比例30%
> - 500万以上：分成比例40%

**判断逻辑**：
```python
if "阶梯" in text:
    return 5  # 买断阶梯分成/阶梯分成
```

**提取字段**：
- 结算类型：5
- 阶梯分成线（静态漫画）：0-10万/10万-50万/50万以上
- 净收益分成比例（静态漫画）：30%/40%/50%
- 流水收入累计（动态漫画）：0-100万/100万-500万/500万以上
- 分成比例（动态漫画）：20%/30%/40%

---

### 类型6：其他

**识别特征**：
- ❌ 不符合上述任何类型
- ❌ 无法从合同中明确判断结算方式
- ❌ 结算方式描述模糊或缺失

**合同原文示例**：
> 双方另行签署补充协议约定分成方式。

**判断逻辑**：
```python
else:
    return 6  # 其他
```

---

## 复合场景处理

### 场景1：多种结算方式并存

某些合同可能同时包含多种结算方式，需要根据主要结算方式判断：

**示例**：
> 1. 连载费用：稿费250元/幅 + 实际收入10%分成（主要）
> 2. 形象授权费用：一次性支付5000元（次要）
> 3. 动画运营分成：授权收入15%（次要）

**处理方法**：
- 主要关注"连载费用"部分
- 结算类型：2（买断+奖励分成）

### 场景2：分成模式转换

某些合同约定在特定条件下转换分成模式：

**示例**：
> 当漫画作品单月实际收入的50%高于当月稿费，则由"稿费+分成"模式转为纯分成模式。

**处理方法**：
- 初始模式：类型2（买断+奖励分成）
- 转换后模式：类型4（纯分成）
- **填写初始模式**：2

### 场景3：买断与阶梯分成共存

**示例**：
> 甲方向乙方支付买断金额10000元，同时根据实际收益阶梯分成：
> - 0-50万：30%
> - 50万以上：50%

**处理方法**：
- 结算类型：5（买断阶梯分成）
- 同时填写买断金额和阶梯分成信息

---

## 特殊结算类型

### 动画运营分成
- 自行运营：纯利润的7%
- 授权第三方：授权收入的15%

**不属于主要结算类型，记录在单独字段中**

### 游戏运营分成
- 授权第三方：授权收入的15%

**不属于主要结算类型，记录在单独字段中**

### 作品出版分成
- 线下出版：超过1万本部分版税的50%
- 线下杂志：50%分成

**不属于主要结算类型，记录在单独字段中**

---

## 关键词映射表

| 关键词 | 可能的结算类型 | 优先级 |
|--------|---------------|-------|
| "买断" | 1, 2, 5 | 高 |
| "稿费" | 1, 2 | 高 |
| "元/幅"、"元/页" | 1, 2 | 高 |
| "保底" | 3 | 极高 |
| "阶梯" | 5 | 极高 |
| "分成" | 2, 3, 4, 5 | 中 |
| "纯分成" | 4 | 高 |
| "实际收入的X%" | 2, 4 | 中 |
| "一次性支付" | 1 | 中 |
| "另行协议" | 6 | 低 |

---

## 质量检查

提取结算类型后，请检查：

1. **逻辑一致性**：
   - 如果结算类型=1（买断），必须有买断金额
   - 如果结算类型=2（买断+奖励分成），必须有买断金额和分成比例
   - 如果结算类型=3（保底分成），必须有保底金额和分成比例
   - 如果结算类型=4（纯分成），必须有分成比例
   - 如果结算类型=5（阶梯分成），必须有阶梯分成线和对应比例

2. **数值完整性**：
   - 买断金额不为0
   - 分成比例在0-100%之间
   - 阶梯分成线有明确的区间

3. **币种匹配**：
   - 金额和币种匹配
   - CNY→12, USD→1, HKD→2

---

## 版本信息
- Version: 1.0
- Created: 2025-11-14
